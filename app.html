<!DOCTYPE HTML>
<html>
<head>
<title>Repo Info</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="assets/style.css" media="all" rel="stylesheet" />
<script src="assets/libs.js"></script>
<script src="assets/doT.min.js"></script>
<script src="assets/routie.js"></script>
<script>
var apiUrl, tmple;
window.onload=function(){
apiUrl = [];
apiUrl['repo/home']    = doT.template("https://api.github.com/repos/{{=it.owner}}/{{=it.repo}}?{{? it.access_token }}access_token={{=it.access_token}}{{?}}");
apiUrl['repo/commits'] = doT.template("https://api.github.com/repos/{{=it.owner}}/{{=it.repo}}/commits?per_page={{=it.page_count}}?{{? it.access_token }}&access_token={{=it.access_token}}{{?}}");
tmpl = [];
tmpl['repo/home']      = doT.template(document.getElementById("template-home"));
tmpl['repo/commits']   = doT.template(document.getElementById("template-commit"));
routie('repo/:owner/:repo/home', function(owner,repo) {
  event = "repo/home";
  var requrl   = apiUrl[event]({
    owner: owner, repo: repo, access_token: "" || getParams('access_token')
  });
  var template = tmpl[event];
  console.log("event triggered"+owner+repo);
  console.log(requrl);
  console.log(template);
  jx.load(requrl ,function(data){
    data = JSON.parse(data);
    d = data;
    document.getElementById("message").innerHTML = template(data);
  });
});
routie('repo/:owner/:repo/commits', function(owner,repo) {
  event = "repo/commits";
  console.log("event triggered"+owner+repo);
  jx.load(apiUrl[event] ,function(data){
    data = JSON.parse(data);
    d = data;
    document.getElementById("message").innerHTML = tmpl[event](data);
  });
});
}
</script>
</head>
<body>
<div id="main">
          <div class="nav">
          
        <a href="index">Home</a> &bull;
      </div>
      <br />
      <h1>Repo Info</h1>
      <h2>Commits</h2>
      <hr />
      <div id="message">
        Page loading
      </div>
      <div id="footer">
        ~
      </div>
</div>
<script type="text/html-tmpl" id="template-commit">
{{~it :value:index}}
  {{=value.commit.message}} - {{=value.commit.author.name}} <br />
{{~}}
</script>
<script type="text/html-tmpl" id="template-home">
<b>{{=it.full_name}}</b> is a repository mainly written in {{=it.language}}, and currently has {{=it.issues_count || 'no'}} open issues. It has been starred by {{=it.stargazers_count || 'nobody'}} and is being followed by {{=it.watchers_count||'nobody'}}.
</script>
<script type="text/html-tmpl" id="template-body">

</script>
</body>
</html>
